# SSCDFPC

# nodemodule 的bootstrap包有替换

# 前端文档

## 技术栈
- 项目采用Angular5,Angular-cli [ngx-echarts图表框架,angular封装的echarts](https://xieziyu.github.io/ngx-echarts), [ng-bootstrap UI框架](https://ng-bootstrap.github.io/#/home),Typescript,ng-router,Jquery,[jQRangeSlider滑动插件](http://ghusse.github.io/jQRangeSlider/)

## 项目结构
- docs: 项目的文档,一些采坑和调研的记录
- src: 代码
  + app: 应用入口
    * component: 项目所有组件(页面组件和公共组件)
    * overview: 主页面目录(暂时两个页面forecast page2和# map-information page1)
      ```bash
      # component 页面组件和公共组件
      # overview  主页面目录(暂时两个页面forecast page2和# map-information page1)
      # map-information page1
      # forecast page2
      ```
    * service: 项目的服务
  + assets静态文件
  + index.html 主页面

## 组件划分
- 不加前缀的是公共组件
  + header
- ov前缀的是page1的组件
  + ov-map
  + ov-select
  + ov-select-details
  + ov-kpi
  + ov-rank
- fa前缀的是page2的组件
  + fa-main
  + fa-sidebar

## 组件详解(page1)
- ov-map
  + 简介
    ```bash
    # 地图和左边sideBar的组件,点击sideBar动态更换地图的数据
    ```
  + 地图点击事件
    ```java
    private onChartEventclick() {

    }
    ```
  + 地图hover事件
    ```java
    private initChartMap(ec) {

    }
    ```
  + 点击sideBar切换数据
    ```java
    # 通过点击事件,动态更改this.mapData的数据

    // 点击左边菜单时设置索引设置默认地图高亮
    private setSidebarlCurrent() {}
    // 点击左边菜单时设置索引设置默认地图高亮
    private setSidebarrCurrent() {}
    // 请求渲染左边菜单数据
    private setMapListLiftTotal() {}
    // 请求渲染右边菜单数据
    private setMapListRightTotal() {}
    ```
- ov-select
  + 简介
    ```bash
    # 组合选择下拉框组件
    ```
  + 点击事件 geo和region
- ov-select-details
  + 简介
    ```bash
    # details下拉框组件
    ```
- ov-rank
  + 简介
    ```bash
    # rank排行组件,点击kpi图表显示,点击其它地方关闭,点击事件触发时获取到select和select-details的参数传给后台获取到数据从新渲染rank组件的数据.
    ```
## 组件详解(page2)
- fa-sidebar
  + 简介
  ```bash
  # 左边pn号的搜索和信息
  ```
- fa-main
  + 简介
  ```bash
  # 右边tab nav 图表数据展示
  ```
## angular使用echarts
- ov-map demo
  ```html
  <!-- $event            事件传入的$event是echarts图表数据的event对象,可以看到一些evenet信息,当前点击的地图区域名字,和坐标之类的 -->
  <!-- echart            必须引入的属性 -->
  <!-- [options]         echarts配置项对象数据(tooltip,toolbox,geo,series等等这些配置项) -->
  <!-- [loading]         是否显示加载动画 -->
  <!-- chartInit         初始化echart实例(在这个定义的方法里可以自定义点击事件和鼠标hover事件,因为当图像为折线图或柱状图的时候,点击或者hover图表意外的区域,事件没有反应,就只能用自定义的) -->
  <!-- chartMouseOver    鼠标移入事件 -->
  <!-- chartMouseOut     鼠标离开事件 -->
  <!-- chartClick        鼠标点击事件 -->
  <div echarts [options]="options_map" 
       [loading]="isLoading" 
       (chartInit)="initChartMap($event)" 
       (chartMouseOver)="onChartEvent($event, 'chartMouseOver')"
       (chartMouseOut)="onChartEvent($event, 'chartMouseOut')" 
       (chartClick)="onChartEventclick($event, 'chartClick')"
       class="echart">
  </div>
  ```
  + chartInit 自定义事件 demo
  ```java
  // ov-kpi 组件demo
  private onChartInitPal(ec) {
    // 给实例重新赋值
    this.echartsInstance_pal = ec;
    // 给赋值的实例添加click事件
    this.echartsInstance_pal.getZr().on('click', param => {
      // param 可获取点击或者hover区域的坐标
    };
    // 给赋值的实例添加mousemove事件
    this.echartsInstance_pal.getZr().on('mousemove', param => {};
    // 给赋值的实例添加globalout事件
    this.echartsInstance_pal.getZr().on('globalout', param => {};
  }
  
  ```
- echarts converToPixel 方法demo
  ```bash
  # ov-map.component.ts 文件里的 setFiveAreaData方法有详细介绍
  ```
- echarts setOption 方法 可以从新设置图表的配置项
  ```java
  // ov-map.component.ts 文件里的 switchMissScatter方法有demo 可参照
  this.echartsInstance_map.setOption({
    // 从新配置series, 这个echarts 官方文档也有介绍直接搜 setOption即可
    series: []
  });
  ```
- echarts dispatchAction的 highlight方法 可以设置map地图的高亮
```java
// ov-map.component.ts 文件里的 onChartEvent 方法里有demo
// 具体使用文档 参考echarts 官方文档 搜索 dispatchAction即可
this.echartsInstance_map.dispatchAction({
  type: 'highlight',
  seriesIndex: 0,
  dataIndex: this.worldMapData.areaDataIndex.LAS  // 需要高亮的国家的索引数组
});
```
- echarts dispatchAction的 showTip方法 可以设置图表的toolTip显示隐藏
```java
// fa-main.component.ts 文件里的 setTooltipMf 方法里有demo
// 具体使用文档 参考echarts 官方文档 搜索 dispatchAction即可
this.echartsInstance_mf.dispatchAction({
  type: 'showTip',
  seriesIndex: sIndex,
  dataIndex: dIndex
});
```
## angular 监听全局事件(@HostListener)
- 监听点击事件
```java
// 用来判断点击的是不是当前组件,实现点击其它地方关闭当前组件的功能
// 具体参考 ov-select-details.component.ts 里的 insideClick方法
@HostListener('document:click', ['$event.target'])
  public insideClick(targetElement) {
    const clickedInside = this.elementRef.nativeElement.contains(event.target);
    console.log(clickedInside);
    if (!clickedInside) {
      this.checkboxShow = false;
    }
  }
```

## angular service 订阅数据

- 监听获取数据用的是 update-data.service.ts 文件
```java
// 使用demo
private updateSubject: Subject<any> = new Subject<any>();     // 实例化一个监听对象
// 获取数据方法
public getUpdateSubject(): Observable<any> {
  return this.updateSubject;
}
// 发送数据方法
public emitUpdateInfo(msg: any): void {
  if (msg) {
      this.updateSubject.next(msg);
  }
}
// 组件调用参考 ov-select组件的closeRank方法和ov-kpi的updateSubscription方法
```

## angular http请求
- http封装获取数据用的是getjson.service.ts 文件
```bash
# getjson.service.ts里的apiGet方法是封装的获取数据的方法,组件调用参考ov-kpi.component.ts的kpiPublickAjax方法
```

## page1和page2的动画控制
- 执行动画
  ```java
  // 参考 fa-main-component.ts 的byAnimation方法
  this.byAnimation();     // 执行动画定时器
  ```
- 监听鼠标定时器
  ```java
  // 参考 fa-main-component.ts 的byAnimation方法
  private judegeMouseMove(event: Event) {};
  ```

## page2 Duration时间轴插件控制数据
```bash
# 参考 fa-main-component.ts 的 ngAfterViewInit里执行的 $('#rangeSlider')的方法
```

## 31和33 服务器切换
```bash
# 修改 service文件里的getjson.service.ts 里的 proUrl 变量即可
```
